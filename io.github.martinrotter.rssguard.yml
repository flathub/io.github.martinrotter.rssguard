id: io.github.martinrotter.rssguard
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang # To build rssguard-article-extractor
command: rssguard

finish-args:
  - --device=dri
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.Notifications

modules:
  - name: clang-format
    buildsystem: cmake-ninja
    subdir: llvm
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=MinSizeRel
      - -DBUILD_SHARED_LIBS=OFF
      - -DLLVM_ENABLE_PROJECTS=clang
    make-args:
      - clang-format
    no-make-install: true
    build-commands:
      - install -Dt /app/bin bin/clang-format
    sources:
      - type: archive
        url: https://github.com/llvm/llvm-project/releases/download/llvmorg-22.1.0/llvm-project-22.1.0.src.tar.xz
        sha256: 25d2e2adc4356d758405dd885fcfd6447bce82a90eb78b6b87ce0934bd077173
        x-checker-data:
          type: anitya
          project-id: 1830
          stable-only: true
          url-template: https://github.com/llvm/llvm-project/releases/download/llvmorg-$version/llvm-project-$version.src.tar.xz

  - name: rssguard
    buildsystem: cmake-ninja
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOROOT: /usr/lib/sdk/golang
    config-opts:
      - -DIS_DEV_BUILD=OFF
      - -DREVISION_FROM_GIT=OFF
      - -DNO_UPDATE_CHECK=ON
      - -DIS_FLATPAK_BUILD=ON
      - -DENABLE_MEDIAPLAYER_LIBMPV=OFF
      - -DENABLE_MEDIAPLAYER_QTMULTIMEDIA=OFF
    sources:
      - type: archive
        url: https://github.com/martinrotter/rssguard/releases/download/5.0.0/rssguard-5.0.0-src.tar.gz
        sha256: 4500b35897b41fefe0b042e44b50aecfb4afd47cfdda265fdc0c31cd725136b9
        x-checker-data:
          type: anitya
          project-id: 19046
          stable-only: true
          url-template: https://github.com/martinrotter/rssguard/releases/download/$version/rssguard-$version-src.tar.gz
      - type: patch
        paths:
          # https://github.com/martinrotter/rssguard/pull/2031
          - patches/0001-Fix-building-with-ENABLE_MEDIAPLAYER_-LIBMPV-QTMULTI.patch
    cleanup:
      - /include
